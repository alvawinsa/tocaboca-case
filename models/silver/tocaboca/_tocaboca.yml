models:
  - name: stg_events
    description: >
      Staging model for the GA4 events for Toba Boba World game. Flattened to be
      one row per a single event. Deduplicated.
    columns:
      - name: event_date
        description: Date of the event as logged by GA4
        data_type: date
      - name: event_timestamp
        description: Timestamp in UTC of the event as logged by GA4
        data_type: datetime
      - name: event_name
        description: Name of the GA4 event (e.g., app_started, purchase, level_up).
        data_type: string
      - name: device_id
        description: >
          Identifier for the device. Can be null and negative. The id should change a re-installation.
          It is manually set by the app on first start and may therefore be missing on some early events.
        data_type: integer
      - name: install_id
        description: >
          Unique ID for the app installation on a device. Each installation of the app has a globally unique id.
          If the app is uninstalled and reinstalled it will have a new install_id.
        data_type: integer
      - name: device_category
        description: Type of device used for event
        data_type: string
        data_tests:
          - accepted_values:
              values: ["smart tv", "tablet", "desktop", "mobile"]
      - name: install_source
        description: >
          Store or source the app was installed from, installer package name, e.g.
          Google play store ('com.android.vending')
        data_type: string
      - name: ingested_at
        description: Timestamp in UTC when the raw event was ingested into the bronze layer.
        data_type: datetime
        data_tests:
          - not_null
      - name: count
        description: Honestly I don't know, but would add something useful here :)
        data_type: integer
      - name: currency_code
        description: Currency code for the purchase events
        data_type: string
      - name: is_engaged_session_event
        description: If an event deemed as engaging has happened, e.g. viewing certain screen.
        data_type: boolean
      - name: is_conversion_event
        description: >
          Boolean flag if the event is marked as a Firebase conversion. This is
          when an event tied to an important business outcome happens, e.g. a purchase
          or a signup.
        data_type: boolean
      - name: event_origin
        description: >
          Origin of event: app, or auto
        data_type: string
      - name: screen_class
        description: Screen class name where the event occurred.
        data_type: string
      - name: screen_id
        description: Unique identifier for the screen within Firebase context.
        data_type: string
      - name: ga_dedupe_id
        description: >
          Identifier used by GA4 to deduplicate events.
        data_type: string
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: ga_session_id
        description: ID of the GA4 session this event belongs to. Not globally unique.
        data_type: bigint
        data_tests:
          - not_null:
              config:
                severity: warn # my feeling is that they shouldn't be null, but not time to look into
      - name: ga_session_number
        description: Number of sessions in sequence device has had.
        data_type: integer
      - name: price
        description: Price of the item in local currency.
        data_type: float
      - name: product_name
        description: If an 'in_app_purchase' event, then the name of product bought.
        data_type: string
      - name: quantity
        description: Quantity of products bought.
        data_type: integer
      - name: reason
        description: Reason stored for event, context, e.g. as to why app crashed
        data_type: string
      - name: is_session_engaged
        description: >
          Boolean flag if the session was considered engaged. GA4 considers it engaged
          if any of the following is met
            - session lasted 10s or longer,
            - session included one or more events considered conversion events
            - user viewed 2 or more pages during session
        data_type: boolean
      - name: has_subscription
        description: I'm assuming boolean flag for if the session is attributed to a subscription.
        data_type: boolean
      - name: is_validated
        description: Boolean flag indicating if the event has been validated, assume by GA4
        data_type: boolean
      - name: value
        description: Monetary or numeric value associated with the event (scaled down to decimal).
        data_type: float
      - name: event_key
        description: >
          a synthetic key composed of event_timestamp, event_name, install_id, and device_id to
          better keep integrity and test for uniqueness
        data_type: string
        data_tests:
          - unique

  - name: stg_products
    description: staging model for Toba Boba world products, one row per product
    columns:
      - name: product_name
        description: Toba Boba's name of the product
        data_type: string
        data_tests:
          - unique
          - not_null
      - name: product_type
        description: higher level category of the product
        data_type: string
        data_tests:
          - not_null
          - accepted_values:
              values:
                - "creator pack"
                - "playset"
                - "bundle"
      - name: product_subtype
        description: sub category of product type
        data_type: string
        data_tests:
          - not_null
          - accepted_values:
              values:
                - "character creator upgrade"
                - "character creator style pack"
                - "home designer template pack"
                - "home designer furniture pack"
                - "playset"
                - "bundle"
                - "home designer empty building"
  - name: stg_exchange_rates
    description: >
      contains exchange rates to usd, one row per day per currency code. Only
      contains currencies that have actually been used in purchases
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - currency_code
    columns:
      - name: date
        description: date of the exchange rate
        data_type: date
      - name: currency_code
        description: the code for the currency, only ones relevant from app
        data_type: string
      - name: usd_per_currency
        description: conversion rate from currency to usd
        data_type: float
